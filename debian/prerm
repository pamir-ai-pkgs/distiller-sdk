#!/bin/sh
set -e

case "$1" in
remove | upgrade | deconfigure)
	# Stop any running Python processes from the SDK's virtual environment
	if [ -d "/opt/distiller-sdk/.venv" ]; then
		VENV_PYTHON="/opt/distiller-sdk/.venv/bin/python"
		if [ -f "$VENV_PYTHON" ]; then
			PIDS=$(lsof -t "$VENV_PYTHON" 2>/dev/null || true)
			if [ -n "$PIDS" ]; then
				echo "INFO: Stopping SDK Python processes..."
				for pid in $PIDS; do
					kill -TERM "$pid" 2>/dev/null || true
				done
				sleep 2
			fi
		fi
	fi
	;;

failed-upgrade) ;;

*)
	echo "ERROR: prerm called with unknown argument \`$1'" >&2
	exit 1
	;;
esac

#DEBHELPER#

exit 0
