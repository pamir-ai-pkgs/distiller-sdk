#!/bin/bash
set -e

# Pre-removal script for distiller-cm5-sdk
if [ "$1" = "remove" ] || [ "$1" = "upgrade" ] || [ "$1" = "deconfigure" ]; then
	echo "Preparing to remove distiller-cm5-sdk..."

	# Stop any running Python processes from the SDK's virtual environment
	if [ -d "/opt/distiller-cm5-sdk/.venv" ]; then
		VENV_PYTHON="/opt/distiller-cm5-sdk/.venv/bin/python"
		if [ -f "$VENV_PYTHON" ]; then
			PIDS=$(lsof -t "$VENV_PYTHON" 2>/dev/null || true)
			if [ -n "$PIDS" ]; then
				echo "Stopping SDK Python processes..."
				for pid in $PIDS; do
					kill -TERM "$pid" 2>/dev/null || true
				done
				sleep 2
			fi
		fi
	fi
fi

#DEBHELPER#
