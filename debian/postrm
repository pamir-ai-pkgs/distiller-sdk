#!/bin/sh
set -e

case "$1" in
remove | upgrade | deconfigure)
	# Remove virtual environment
	[ -d "/opt/distiller-sdk/.venv" ] && rm -rf /opt/distiller-sdk/.venv

	# Remove generated files
	rm -f /opt/distiller-sdk/.python-version 2>/dev/null || true
	rm -f /opt/distiller-sdk/activate.sh 2>/dev/null || true
	rm -f /opt/distiller-sdk/eink.conf 2>/dev/null || true

	# Remove any Python cache files
	find /opt/distiller-sdk -type d -name "__pycache__" -exec rm -rf {} + 2>/dev/null || true
	find /opt/distiller-sdk -type f -name "*.pyc" -delete 2>/dev/null || true
	find /opt/distiller-sdk -type f -name "*.pyo" -delete 2>/dev/null || true

	# Remove symlink to shared library
	[ -L "/usr/lib/libdistiller_display_sdk_shared.so" ] &&
		rm -f /usr/lib/libdistiller_display_sdk_shared.so

	# Clean up uv cache to save disk space
	uv cache clean || true
	;;

purge)
	# Remove the entire installation directory
	[ -d "/opt/distiller-sdk" ] && rm -rf /opt/distiller-sdk

	# Clean up temporary files
	find /tmp -maxdepth 1 -name 'distiller-*' -type f -delete 2>/dev/null || true
	find /var/run -maxdepth 1 -name 'distiller-*' -type f -delete 2>/dev/null || true
	find /var/lock -maxdepth 1 -name 'distiller-*' -type f -delete 2>/dev/null || true
	;;

failed-upgrade | abort-install | abort-upgrade | disappear) ;;

*)
	echo "ERROR: postrm called with unknown argument \`$1'" >&2
	exit 1
	;;
esac

#DEBHELPER#

exit 0
